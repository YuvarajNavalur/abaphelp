<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yuvaraj's ABAP Code Studio | SAP Development Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0e14;
            --bg-secondary: #101720;
            --bg-tertiary: #1a2332;
            --bg-card: #141c28;
            --accent-blue: #00d4ff;
            --accent-orange: #ff6b35;
            --accent-green: #00ff9d;
            --accent-purple: #a855f7;
            --text-primary: #e8edf5;
            --text-secondary: #8b98a9;
            --text-muted: #5a6678;
            --border-color: #2a3545;
            --sap-gold: #f0ab00;
            --code-bg: #0d1117;
            --success: #22c55e;
            --warning: #eab308;
            --error: #ef4444;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .bg-pattern {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0.4;
            background: 
                radial-gradient(ellipse 80% 50% at 20% 40%, rgba(0, 212, 255, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse 60% 40% at 80% 60%, rgba(255, 107, 53, 0.06) 0%, transparent 50%);
        }

        .header {
            position: relative;
            z-index: 10;
            padding: 1.5rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border-color);
            background: rgba(10, 14, 20, 0.9);
            backdrop-filter: blur(20px);
        }

        .logo { display: flex; align-items: center; gap: 1rem; }

        .logo-icon {
            width: 48px; height: 48px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700; font-size: 1.2rem;
            color: var(--bg-primary);
        }

        .logo-title { font-size: 1.4rem; font-weight: 700; }
        .logo-subtitle { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.1em; }

        .header-badge {
            padding: 0.5rem 1rem;
            background: rgba(240, 171, 0, 0.1);
            border: 1px solid rgba(240, 171, 0, 0.3);
            border-radius: 100px;
            font-size: 0.8rem;
            color: var(--sap-gold);
        }

        .main-container {
            position: relative; z-index: 10;
            max-width: 1600px; margin: 0 auto; padding: 2rem;
        }

        .tab-nav {
            display: flex; gap: 0.5rem; margin-bottom: 2rem;
            background: var(--bg-secondary); padding: 0.5rem;
            border-radius: 16px; border: 1px solid var(--border-color);
            width: fit-content;
        }

        .tab-btn {
            display: flex; align-items: center; gap: 0.75rem;
            padding: 1rem 2rem; background: transparent; border: none;
            border-radius: 12px; font-family: 'DM Sans', sans-serif;
            font-size: 0.95rem; font-weight: 600;
            color: var(--text-secondary); cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-btn:hover { color: var(--text-primary); background: var(--bg-tertiary); }
        .tab-btn.active {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            color: var(--bg-primary);
        }

        .tab-icon { width: 20px; height: 20px; }
        .tab-content { display: none; animation: fadeIn 0.4s ease; }
        .tab-content.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 20px; padding: 2rem; margin-bottom: 1.5rem;
        }

        .card-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem; }

        .card-icon {
            width: 44px; height: 44px; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
        }

        .card-icon.blue { background: rgba(0, 212, 255, 0.15); color: var(--accent-blue); }
        .card-icon.orange { background: rgba(255, 107, 53, 0.15); color: var(--accent-orange); }
        .card-icon.green { background: rgba(0, 255, 157, 0.15); color: var(--accent-green); }
        .card-icon.purple { background: rgba(168, 85, 247, 0.15); color: var(--accent-purple); }

        .card-title { font-size: 1.1rem; font-weight: 600; }
        .card-description { font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.25rem; }

        .form-group { margin-bottom: 1.5rem; }
        .form-label {
            display: block; font-size: 0.85rem; font-weight: 600;
            color: var(--text-secondary); margin-bottom: 0.75rem;
            text-transform: uppercase; letter-spacing: 0.05em;
        }

        .form-textarea {
            width: 100%; min-height: 140px; padding: 1.25rem;
            background: var(--bg-secondary); border: 1px solid var(--border-color);
            border-radius: 12px; font-family: 'DM Sans', sans-serif;
            font-size: 0.95rem; color: var(--text-primary);
            resize: vertical; transition: all 0.3s ease;
        }

        .form-textarea:focus {
            outline: none; border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
        }

        .form-textarea::placeholder { color: var(--text-muted); }

        .form-textarea.code-input {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem; min-height: 280px;
        }

        .form-select {
            width: 100%; padding: 1rem 1.25rem;
            background: var(--bg-secondary); border: 1px solid var(--border-color);
            border-radius: 12px; font-family: 'DM Sans', sans-serif;
            font-size: 0.95rem; color: var(--text-primary); cursor: pointer;
        }

        .form-select:focus { outline: none; border-color: var(--accent-blue); }

        .chips-container { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.75rem; }

        .chip {
            padding: 0.5rem 1rem; background: var(--bg-tertiary);
            border: 1px solid var(--border-color); border-radius: 100px;
            font-size: 0.85rem; color: var(--text-secondary);
            cursor: pointer; transition: all 0.2s ease;
        }

        .chip:hover { border-color: var(--accent-blue); color: var(--accent-blue); }
        .chip.selected {
            background: rgba(0, 212, 255, 0.15);
            border-color: var(--accent-blue); color: var(--accent-blue);
        }

        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; }
        @media (max-width: 1024px) { .grid-2 { grid-template-columns: 1fr; } }

        .btn {
            display: inline-flex; align-items: center; justify-content: center;
            gap: 0.75rem; padding: 1rem 2rem; border: none; border-radius: 12px;
            font-family: 'DM Sans', sans-serif; font-size: 1rem; font-weight: 600;
            cursor: pointer; transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            color: var(--bg-primary);
        }

        .btn-primary:hover { transform: translateY(-2px); }
        .btn-secondary {
            background: var(--bg-tertiary); color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover { border-color: var(--accent-blue); color: var(--accent-blue); }
        .btn-group { display: flex; gap: 1rem; margin-top: 1.5rem; }

        .code-output-container {
            background: var(--code-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px; overflow: hidden;
        }

        .code-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 1rem 1.5rem; background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
        }

        .code-header-left { display: flex; align-items: center; gap: 1rem; }
        .code-dots { display: flex; gap: 0.5rem; }
        .code-dot { width: 12px; height: 12px; border-radius: 50%; }
        .code-dot.red { background: #ff5f56; }
        .code-dot.yellow { background: #ffbd2e; }
        .code-dot.green { background: #27ca40; }

        .code-filename {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem; color: var(--text-secondary);
        }

        .code-actions { display: flex; gap: 0.5rem; }

        .code-action-btn {
            display: flex; align-items: center; justify-content: center;
            width: 36px; height: 36px; background: var(--bg-tertiary);
            border: 1px solid var(--border-color); border-radius: 8px;
            color: var(--text-secondary); cursor: pointer; transition: all 0.2s ease;
        }

        .code-action-btn:hover { border-color: var(--accent-blue); color: var(--accent-blue); }

        .code-content { padding: 1.5rem; max-height: 500px; overflow: auto; }

        .code-content pre {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem; line-height: 1.7;
            color: var(--text-primary); white-space: pre-wrap;
            word-wrap: break-word; margin: 0;
        }

        .metrics-grid {
            display: grid; grid-template-columns: repeat(4, 1fr);
            gap: 1rem; margin-bottom: 1.5rem;
        }

        @media (max-width: 1024px) { .metrics-grid { grid-template-columns: repeat(2, 1fr); } }

        .metric-card {
            background: var(--bg-secondary); border: 1px solid var(--border-color);
            border-radius: 12px; padding: 1.25rem; text-align: center;
        }

        .metric-value { font-size: 2rem; font-weight: 700; color: var(--accent-blue); line-height: 1; }
        .metric-label { font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem; text-transform: uppercase; }

        .analysis-section { margin-bottom: 1.5rem; }
        .analysis-header { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem; }
        .analysis-title { font-size: 1rem; font-weight: 600; }

        .analysis-badge {
            padding: 0.25rem 0.75rem; border-radius: 100px;
            font-size: 0.75rem; font-weight: 600;
        }

        .badge-success { background: rgba(34, 197, 94, 0.15); color: var(--success); }
        .badge-warning { background: rgba(234, 179, 8, 0.15); color: var(--warning); }
        .badge-error { background: rgba(239, 68, 68, 0.15); color: var(--error); }
        .badge-info { background: rgba(0, 212, 255, 0.15); color: var(--accent-blue); }

        .analysis-list { list-style: none; }

        .analysis-item {
            display: flex; align-items: flex-start; gap: 0.75rem;
            padding: 0.75rem 1rem; background: var(--bg-secondary);
            border-radius: 8px; margin-bottom: 0.5rem;
            font-size: 0.9rem; color: var(--text-secondary);
        }

        .analysis-item-icon {
            flex-shrink: 0; width: 20px; height: 20px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 0.7rem;
        }

        .analysis-item-icon.error { background: rgba(239, 68, 68, 0.2); color: var(--error); }
        .analysis-item-icon.warning { background: rgba(234, 179, 8, 0.2); color: var(--warning); }
        .analysis-item-icon.info { background: rgba(0, 212, 255, 0.2); color: var(--accent-blue); }

        .loading-overlay {
            display: none; position: fixed; top: 0; left: 0;
            width: 100%; height: 100%; background: rgba(10, 14, 20, 0.9);
            z-index: 1000; justify-content: center; align-items: center;
            flex-direction: column; gap: 1.5rem;
        }

        .loading-overlay.active { display: flex; }

        .loading-spinner {
            width: 60px; height: 60px;
            border: 3px solid var(--border-color);
            border-top-color: var(--accent-blue);
            border-radius: 50%; animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { font-size: 1.1rem; color: var(--text-secondary); }

        .empty-state { text-align: center; padding: 4rem 2rem; color: var(--text-muted); }

        .empty-state-icon {
            width: 80px; height: 80px; margin: 0 auto 1.5rem;
            background: var(--bg-tertiary); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
        }

        .empty-state-title { font-size: 1.25rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 0.5rem; }

        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }

        @media (max-width: 768px) {
            .header { flex-direction: column; gap: 1rem; }
            .main-container { padding: 1rem; }
            .tab-nav { width: 100%; }
            .tab-btn { flex: 1; padding: 0.75rem; font-size: 0.85rem; }
            .btn-group { flex-direction: column; }
            .btn { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingText">Processing...</div>
    </div>

    <header class="header">
        <div class="logo">
            <div class="logo-icon">AB</div>
            <div class="logo-text">
                <div class="logo-title">ABAP Code Studio</div>
                <div class="logo-subtitle">SAP Development Assistant</div>
            </div>
        </div>
        <div class="header-badge">AI-Powered</div>
    </header>

    <main class="main-container">
        <div class="tab-nav">
            <button class="tab-btn active" id="genTabBtn">
                <svg class="tab-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
                </svg>
                Code Generator
            </button>
            <button class="tab-btn" id="refTabBtn">
                <svg class="tab-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                </svg>
                Code Refiner
            </button>
        </div>

        <div class="tab-content active" id="generateTab">
            <div class="grid-2">
                <div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon blue">
                                <svg width="22" height="22" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                            </div>
                            <div>
                                <div class="card-title">Requirement Description</div>
                                <div class="card-description">Describe what you want the ABAP code to do</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <textarea class="form-textarea" id="requirement" placeholder="Example: Create an ALV report that displays sales orders from VBAK table with customer name, filtered by date range and sales organization..."></textarea>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon orange">
                                <svg width="22" height="22" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                </svg>
                            </div>
                            <div>
                                <div class="card-title">Key Points</div>
                                <div class="card-description">Tables, fields, specific requirements</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <textarea class="form-textarea" id="keyPoints" placeholder="- Tables: VBAK, VBAP, KNA1&#10;- Fields: Order number, Customer, Material&#10;- Selection screen: Date range, Sales Org"></textarea>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon green">
                                <svg width="22" height="22" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                            </div>
                            <div>
                                <div class="card-title">Configuration</div>
                                <div class="card-description">Code type and preferences</div>
                            </div>
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label class="form-label">Code Type</label>
                                <select class="form-select" id="codeType">
                                    <option value="report">Report Program</option>
                                    <option value="class">ABAP OO Class</option>
                                    <option value="function">Function Module</option>
                                    <option value="cds">CDS View</option>
                                    <option value="rap">RAP Business Object</option>
                                    <option value="amdp">AMDP Procedure</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ABAP Version</label>
                                <select class="form-select" id="abapVersion">
                                    <option value="new">Modern ABAP 7.4+</option>
                                    <option value="s4">S/4HANA Cloud</option>
                                    <option value="classic">Classic ABAP</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Features</label>
                            <div class="chips-container" id="featuresContainer">
                                <span class="chip selected" data-value="inline">Inline Declarations</span>
                                <span class="chip selected" data-value="expressions">String Expressions</span>
                                <span class="chip" data-value="exceptions">Exception Handling</span>
                                <span class="chip" data-value="unit-test">Unit Test</span>
                                <span class="chip" data-value="authority">Authority Checks</span>
                            </div>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-primary" id="generateBtn">Generate ABAP Code</button>
                            <button class="btn btn-secondary" id="clearGenBtn">Clear</button>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon purple">
                                <svg width="22" height="22" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
                                </svg>
                            </div>
                            <div>
                                <div class="card-title">Generated Code</div>
                                <div class="card-description">Your ABAP code</div>
                            </div>
                        </div>
                        <div id="generatedCodeContainer">
                            <div class="empty-state">
                                <div class="empty-state-icon">
                                    <svg width="40" height="40" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
                                    </svg>
                                </div>
                                <div class="empty-state-title">No Code Generated Yet</div>
                                <p>Enter requirements and click Generate</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="refineTab">
            <div class="grid-2">
                <div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon orange">
                                <svg width="22" height="22" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                            </div>
                            <div>
                                <div class="card-title">Your ABAP Code</div>
                                <div class="card-description">Paste existing code for analysis</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <textarea class="form-textarea code-input" id="inputCode" placeholder="REPORT zsales_report.

DATA: lt_vbak TYPE TABLE OF vbak,
      ls_vbak TYPE vbak.

SELECT * FROM vbak INTO TABLE lt_vbak.

LOOP AT lt_vbak INTO ls_vbak.
  WRITE: / ls_vbak-vbeln.
ENDLOOP."></textarea>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon blue">
                                <svg width="22" height="22" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                            </div>
                            <div>
                                <div class="card-title">Additional Requirements</div>
                                <div class="card-description">Describe changes or enhancements</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <textarea class="form-textarea" id="refineRequirement" placeholder="Example: Add ALV display, convert to OO, add selection screen for date range, optimize SELECT..."></textarea>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon green">
                                <svg width="22" height="22" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/>
                                </svg>
                            </div>
                            <div>
                                <div class="card-title">Refinement Options</div>
                                <div class="card-description">Select improvements</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="chips-container" id="refineOptionsContainer">
                                <span class="chip selected" data-value="modernize">Modernize Syntax</span>
                                <span class="chip selected" data-value="performance">Optimize Performance</span>
                                <span class="chip selected" data-value="debug">Debug & Fix</span>
                                <span class="chip" data-value="comments">Add Comments</span>
                                <span class="chip" data-value="error-handling">Error Handling</span>
                                <span class="chip" data-value="alv">Add ALV</span>
                                <span class="chip" data-value="selection">Selection Screen</span>
                            </div>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-primary" id="refineBtn">Analyze & Refine</button>
                            <button class="btn btn-secondary" id="clearRefBtn">Clear</button>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="card" id="analysisCard" style="display: none;">
                        <div class="card-header">
                            <div class="card-icon blue">
                                <svg width="22" height="22" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                                </svg>
                            </div>
                            <div>
                                <div class="card-title">Code Analysis</div>
                                <div class="card-description">Issues and suggestions</div>
                            </div>
                        </div>
                        <div class="metrics-grid" id="metricsGrid"></div>
                        <div id="analysisResults"></div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon purple">
                                <svg width="22" height="22" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                                </svg>
                            </div>
                            <div>
                                <div class="card-title">Refined Code</div>
                                <div class="card-description">Optimized output</div>
                            </div>
                        </div>
                        <div id="refinedCodeContainer">
                            <div class="empty-state">
                                <div class="empty-state-icon">
                                    <svg width="40" height="40" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                    </svg>
                                </div>
                                <div class="empty-state-title">No Code Refined Yet</div>
                                <p>Paste code and click Analyze & Refine</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        var generatedPlainCode = '';
        var refinedPlainCode = '';

        // Tab switching
        document.getElementById('genTabBtn').addEventListener('click', function() {
            document.getElementById('genTabBtn').classList.add('active');
            document.getElementById('refTabBtn').classList.remove('active');
            document.getElementById('generateTab').classList.add('active');
            document.getElementById('refineTab').classList.remove('active');
        });

        document.getElementById('refTabBtn').addEventListener('click', function() {
            document.getElementById('refTabBtn').classList.add('active');
            document.getElementById('genTabBtn').classList.remove('active');
            document.getElementById('refineTab').classList.add('active');
            document.getElementById('generateTab').classList.remove('active');
        });

        // Chip selection
        document.querySelectorAll('.chip').forEach(function(chip) {
            chip.addEventListener('click', function() {
                this.classList.toggle('selected');
            });
        });

        function getSelectedChips(containerId) {
            var container = document.getElementById(containerId);
            var selected = [];
            container.querySelectorAll('.chip.selected').forEach(function(chip) {
                selected.push(chip.getAttribute('data-value'));
            });
            return selected;
        }

        function showLoading(text) {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        function escapeHtml(text) {
            return text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        }

        function createCodeOutput(code, filename, targetVar) {
            if (targetVar === 'generated') {
                generatedPlainCode = code;
            } else {
                refinedPlainCode = code;
            }

            var safeCode = escapeHtml(code);

            var html = '<div class="code-output-container">';
            html += '<div class="code-header">';
            html += '<div class="code-header-left">';
            html += '<div class="code-dots"><div class="code-dot red"></div><div class="code-dot yellow"></div><div class="code-dot green"></div></div>';
            html += '<div class="code-filename">' + filename + '</div>';
            html += '</div>';
            html += '<div class="code-actions">';
            html += '<button class="code-action-btn" onclick="copyCode(\'' + targetVar + '\')" title="Copy"><svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg></button>';
            html += '<button class="code-action-btn" onclick="downloadCode(\'' + targetVar + '\', \'' + filename + '\')" title="Download"><svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg></button>';
            html += '</div></div>';
            html += '<div class="code-content"><pre>' + safeCode + '</pre></div>';
            html += '</div>';

            return html;
        }

        function copyCode(targetVar) {
            var code = targetVar === 'generated' ? generatedPlainCode : refinedPlainCode;
            navigator.clipboard.writeText(code).then(function() {
                alert('Code copied!');
            });
        }

        function downloadCode(targetVar, filename) {
            var code = targetVar === 'generated' ? generatedPlainCode : refinedPlainCode;
            var blob = new Blob([code], { type: 'text/plain' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Generate button
        document.getElementById('generateBtn').addEventListener('click', function() {
            var requirement = document.getElementById('requirement').value.trim();
            var keyPoints = document.getElementById('keyPoints').value.trim();
            var codeType = document.getElementById('codeType').value;
            var abapVersion = document.getElementById('abapVersion').value;
            var features = getSelectedChips('featuresContainer');

            if (!requirement) {
                alert('Please enter your requirement.');
                return;
            }

            showLoading('Generating ABAP code...');

            setTimeout(function() {
                var code = generateABAPCode(requirement, keyPoints, codeType, abapVersion, features);
                document.getElementById('generatedCodeContainer').innerHTML = createCodeOutput(code, 'z_generated.abap', 'generated');
                hideLoading();
            }, 1000);
        });

        // Clear generator
        document.getElementById('clearGenBtn').addEventListener('click', function() {
            document.getElementById('requirement').value = '';
            document.getElementById('keyPoints').value = '';
            document.getElementById('generatedCodeContainer').innerHTML = '<div class="empty-state"><div class="empty-state-icon"><svg width="40" height="40" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/></svg></div><div class="empty-state-title">No Code Generated Yet</div><p>Enter requirements and click Generate</p></div>';
        });

        // Refine button
        document.getElementById('refineBtn').addEventListener('click', function() {
            var inputCode = document.getElementById('inputCode').value.trim();
            var refineReq = document.getElementById('refineRequirement').value.trim();
            var options = getSelectedChips('refineOptionsContainer');

            if (!inputCode) {
                alert('Please enter code to analyze.');
                return;
            }

            showLoading('Analyzing code...');

            setTimeout(function() {
                var analysis = analyzeCode(inputCode, options);
                document.getElementById('analysisCard').style.display = 'block';
                displayMetrics(analysis.metrics);
                displayAnalysis(analysis.issues);

                var refined = refineCode(inputCode, options, refineReq);
                document.getElementById('refinedCodeContainer').innerHTML = createCodeOutput(refined, 'z_refined.abap', 'refined');
                hideLoading();
            }, 1000);
        });

        // Clear refiner
        document.getElementById('clearRefBtn').addEventListener('click', function() {
            document.getElementById('inputCode').value = '';
            document.getElementById('refineRequirement').value = '';
            document.getElementById('analysisCard').style.display = 'none';
            document.getElementById('refinedCodeContainer').innerHTML = '<div class="empty-state"><div class="empty-state-icon"><svg width="40" height="40" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg></div><div class="empty-state-title">No Code Refined Yet</div><p>Paste code and click Analyze & Refine</p></div>';
        });

        function generateABAPCode(requirement, keyPoints, codeType, abapVersion, features) {
            var isModern = abapVersion === 'new' || abapVersion === 's4';
            var hasExceptions = features.indexOf('exceptions') >= 0;
            var hasAuthority = features.indexOf('authority') >= 0;
            var hasUnitTest = features.indexOf('unit-test') >= 0;

            if (codeType === 'class') return generateClassCode(requirement, isModern, hasUnitTest);
            if (codeType === 'cds') return generateCDSCode(requirement);
            if (codeType === 'function') return generateFunctionCode(requirement);
            if (codeType === 'rap') return generateRAPCode();
            if (codeType === 'amdp') return generateAMDPCode();
            return generateReportCode(requirement, keyPoints, isModern, hasExceptions, hasAuthority);
        }

        function generateReportCode(req, keyPoints, isModern, hasExc, hasAuth) {
            var code = '*&---------------------------------------------------------------------*\n';
            code += '*& Report  Z_GENERATED_REPORT\n';
            code += '*&---------------------------------------------------------------------*\n';
            code += '*& ' + req.substring(0, 60) + '\n';
            code += '*&---------------------------------------------------------------------*\n';
            code += 'REPORT z_generated_report.\n\n';

            code += 'TYPES: BEGIN OF ty_output,\n';
            code += '         vbeln TYPE vbeln,\n';
            code += '         erdat TYPE erdat,\n';
            code += '         kunnr TYPE kunnr,\n';
            code += '         netwr TYPE netwr_ak,\n';
            code += '       END OF ty_output.\n\n';

            code += 'DATA: gt_output TYPE TABLE OF ty_output.\n\n';

            code += 'PARAMETERS: p_vkorg TYPE vkorg OBLIGATORY.\n';
            code += 'SELECT-OPTIONS: s_erdat FOR sy-datum.\n\n';

            if (hasAuth) {
                code += 'AT SELECTION-SCREEN.\n';
                code += '  AUTHORITY-CHECK OBJECT \'V_VBAK_VKO\'\n';
                code += '    ID \'VKORG\' FIELD p_vkorg\n';
                code += '    ID \'ACTVT\' FIELD \'03\'.\n';
                code += '  IF sy-subrc <> 0.\n';
                code += '    MESSAGE \'No authorization\' TYPE \'E\'.\n';
                code += '  ENDIF.\n\n';
            }

            code += 'START-OF-SELECTION.\n\n';

            if (hasExc) {
                code += '  TRY.\n';
                code += '      PERFORM select_data.\n';
                code += '      PERFORM display_alv.\n';
                code += '    CATCH cx_root INTO DATA(lx_error).\n';
                code += '      MESSAGE lx_error->get_text( ) TYPE \'E\'.\n';
                code += '  ENDTRY.\n\n';
            } else {
                code += '  PERFORM select_data.\n';
                code += '  PERFORM display_alv.\n\n';
            }

            code += '*&---------------------------------------------------------------------*\n';
            code += '*& Form SELECT_DATA\n';
            code += '*&---------------------------------------------------------------------*\n';
            code += 'FORM select_data.\n\n';

            if (isModern) {
                code += '  SELECT vbeln, erdat, kunnr, netwr\n';
                code += '    FROM vbak\n';
                code += '    INTO TABLE @gt_output\n';
                code += '    WHERE vkorg = @p_vkorg\n';
                code += '      AND erdat IN @s_erdat.\n\n';
            } else {
                code += '  SELECT vbeln erdat kunnr netwr\n';
                code += '    FROM vbak\n';
                code += '    INTO TABLE gt_output\n';
                code += '    WHERE vkorg = p_vkorg\n';
                code += '      AND erdat IN s_erdat.\n\n';
            }

            code += '  IF sy-subrc <> 0.\n';
            code += '    MESSAGE \'No data found\' TYPE \'S\' DISPLAY LIKE \'W\'.\n';
            code += '  ENDIF.\n\n';
            code += 'ENDFORM.\n\n';

            code += '*&---------------------------------------------------------------------*\n';
            code += '*& Form DISPLAY_ALV\n';
            code += '*&---------------------------------------------------------------------*\n';
            code += 'FORM display_alv.\n\n';
            code += '  TRY.\n';
            code += '      cl_salv_table=>factory(\n';
            code += '        IMPORTING r_salv_table = DATA(lo_alv)\n';
            code += '        CHANGING t_table = gt_output ).\n\n';
            code += '      lo_alv->get_columns( )->set_optimize( ).\n';
            code += '      lo_alv->get_functions( )->set_all( ).\n';
            code += '      lo_alv->display( ).\n\n';
            code += '    CATCH cx_salv_msg.\n';
            code += '      MESSAGE \'ALV Error\' TYPE \'E\'.\n';
            code += '  ENDTRY.\n\n';
            code += 'ENDFORM.';

            return code;
        }

        function generateClassCode(req, isModern, hasTest) {
            var code = 'CLASS zcl_generated DEFINITION PUBLIC FINAL CREATE PUBLIC.\n\n';
            code += '  PUBLIC SECTION.\n';
            code += '    TYPES: BEGIN OF ty_result,\n';
            code += '             success TYPE abap_bool,\n';
            code += '             message TYPE string,\n';
            code += '           END OF ty_result.\n\n';
            code += '    METHODS:\n';
            code += '      constructor,\n';
            code += '      execute\n';
            code += '        IMPORTING iv_input TYPE string\n';
            code += '        RETURNING VALUE(rs_result) TYPE ty_result.\n\n';
            code += '  PRIVATE SECTION.\n';
            code += '    DATA: mv_init TYPE abap_bool.\n\n';
            code += 'ENDCLASS.\n\n';

            code += 'CLASS zcl_generated IMPLEMENTATION.\n\n';
            code += '  METHOD constructor.\n';
            code += '    mv_init = abap_true.\n';
            code += '  ENDMETHOD.\n\n';
            code += '  METHOD execute.\n';
            code += '    IF iv_input IS INITIAL.\n';
            code += '      rs_result = VALUE #( success = abap_false message = \'Empty input\' ).\n';
            code += '      RETURN.\n';
            code += '    ENDIF.\n\n';
            code += '    rs_result = VALUE #( success = abap_true message = |Processed: { iv_input }| ).\n';
            code += '  ENDMETHOD.\n\n';
            code += 'ENDCLASS.';

            if (hasTest) {
                code += '\n\n';
                code += 'CLASS ltcl_test DEFINITION FOR TESTING DURATION SHORT RISK LEVEL HARMLESS.\n';
                code += '  PRIVATE SECTION.\n';
                code += '    METHODS test_execute FOR TESTING.\n';
                code += 'ENDCLASS.\n\n';
                code += 'CLASS ltcl_test IMPLEMENTATION.\n';
                code += '  METHOD test_execute.\n';
                code += '    DATA(lo_cut) = NEW zcl_generated( ).\n';
                code += '    DATA(ls_result) = lo_cut->execute( \'test\' ).\n';
                code += '    cl_abap_unit_assert=>assert_true( ls_result-success ).\n';
                code += '  ENDMETHOD.\n';
                code += 'ENDCLASS.';
            }

            return code;
        }

        function generateCDSCode(req) {
            var code = '@AbapCatalog.sqlViewName: \'ZV_GENERATED\'\n';
            code += '@AccessControl.authorizationCheck: #CHECK\n';
            code += '@EndUserText.label: \'' + req.substring(0, 40) + '\'\n\n';
            code += 'define view Z_I_Generated as select from vbak {\n';
            code += '  key vbeln as SalesDocument,\n';
            code += '      kunnr as Customer,\n';
            code += '      erdat as CreationDate,\n';
            code += '      netwr as NetValue,\n';
            code += '      waerk as Currency\n';
            code += '}';
            return code;
        }

        function generateFunctionCode(req) {
            var code = 'FUNCTION z_generated_func.\n';
            code += '*" IMPORTING iv_input TYPE string\n';
            code += '*" EXPORTING ev_output TYPE string\n';
            code += '*" EXCEPTIONS invalid_input\n\n';
            code += '  IF iv_input IS INITIAL.\n';
            code += '    RAISE invalid_input.\n';
            code += '  ENDIF.\n\n';
            code += '  ev_output = |Result: { iv_input }|.\n\n';
            code += 'ENDFUNCTION.';
            return code;
        }

        function generateRAPCode() {
            var code = 'managed implementation in class zbp_generated unique;\n';
            code += 'strict ( 2 );\n\n';
            code += 'define behavior for Z_I_Generated alias Generated\n';
            code += 'persistent table ztable\n';
            code += 'lock master\n';
            code += '{\n';
            code += '  field ( readonly ) ID;\n';
            code += '  field ( numbering : managed ) ID;\n\n';
            code += '  create;\n';
            code += '  update;\n';
            code += '  delete;\n';
            code += '}';
            return code;
        }

        function generateAMDPCode() {
            var code = 'CLASS zcl_amdp DEFINITION PUBLIC FINAL CREATE PUBLIC.\n';
            code += '  PUBLIC SECTION.\n';
            code += '    INTERFACES if_amdp_marker_hdb.\n\n';
            code += '    CLASS-METHODS get_data\n';
            code += '      IMPORTING VALUE(iv_vkorg) TYPE vkorg\n';
            code += '      EXPORTING VALUE(et_result) TYPE vbak_t.\n';
            code += 'ENDCLASS.\n\n';
            code += 'CLASS zcl_amdp IMPLEMENTATION.\n';
            code += '  METHOD get_data BY DATABASE PROCEDURE FOR HDB\n';
            code += '    LANGUAGE SQLSCRIPT OPTIONS READ-ONLY USING vbak.\n';
            code += '    et_result = SELECT * FROM vbak WHERE vkorg = :iv_vkorg;\n';
            code += '  ENDMETHOD.\n';
            code += 'ENDCLASS.';
            return code;
        }

        function analyzeCode(code, options) {
            var issues = [];
            var metrics = { linesOfCode: code.split('\n').length, issues: 0, improvements: 0, quality: 100 };

            if (options.indexOf('modernize') >= 0) {
                if (/DATA:.*TYPE TABLE OF/i.test(code)) issues.push({ type: 'warning', message: 'Use inline declarations DATA(...)' });
                if (/CONCATENATE/i.test(code)) issues.push({ type: 'info', message: 'Use string templates |...|' });
            }

            if (options.indexOf('performance') >= 0) {
                if (/SELECT\s+\*/i.test(code)) issues.push({ type: 'error', message: 'Avoid SELECT * - specify fields' });
                if (/SELECT.*ENDSELECT/is.test(code)) issues.push({ type: 'error', message: 'Use INTO TABLE instead of ENDSELECT' });
            }

            if (options.indexOf('debug') >= 0) {
                if (!/TRY.*CATCH/is.test(code)) issues.push({ type: 'warning', message: 'Add TRY...CATCH exception handling' });
                if (!/sy-subrc/i.test(code) && /SELECT/i.test(code)) issues.push({ type: 'warning', message: 'Check SY-SUBRC after SELECT' });
            }

            metrics.issues = issues.filter(function(i) { return i.type === 'error'; }).length;
            metrics.improvements = issues.filter(function(i) { return i.type !== 'error'; }).length;
            metrics.quality = Math.max(0, 100 - metrics.issues * 15 - metrics.improvements * 5);

            return { issues: issues, metrics: metrics };
        }

        function displayMetrics(m) {
            var qColor = m.quality >= 70 ? 'var(--success)' : m.quality >= 40 ? 'var(--warning)' : 'var(--error)';
            var html = '<div class="metric-card"><div class="metric-value">' + m.linesOfCode + '</div><div class="metric-label">Lines</div></div>';
            html += '<div class="metric-card"><div class="metric-value" style="color:var(--error)">' + m.issues + '</div><div class="metric-label">Issues</div></div>';
            html += '<div class="metric-card"><div class="metric-value" style="color:var(--warning)">' + m.improvements + '</div><div class="metric-label">Suggestions</div></div>';
            html += '<div class="metric-card"><div class="metric-value" style="color:' + qColor + '">' + m.quality + '%</div><div class="metric-label">Quality</div></div>';
            document.getElementById('metricsGrid').innerHTML = html;
        }

        function displayAnalysis(issues) {
            if (issues.length === 0) {
                document.getElementById('analysisResults').innerHTML = '<div class="analysis-badge badge-success">No issues found!</div>';
                return;
            }

            var html = '<ul class="analysis-list">';
            issues.forEach(function(i) {
                var icon = i.type === 'error' ? 'error' : i.type === 'warning' ? 'warning' : 'info';
                var symbol = i.type === 'error' ? '!' : i.type === 'warning' ? '' : 'i';
                html += '<li class="analysis-item"><span class="analysis-item-icon ' + icon + '">' + symbol + '</span>' + escapeHtml(i.message) + '</li>';
            });
            html += '</ul>';
            document.getElementById('analysisResults').innerHTML = html;
        }

        function refineCode(code, options, req) {
            var refined = code;

            if (options.indexOf('modernize') >= 0) {
                refined = refined.replace(/SELECT\s+\*\s+FROM\s+(\w+)\s+INTO\s+TABLE\s+(\w+)/gi,
                    'SELECT vbeln, erdat, kunnr, netwr\n    FROM $1\n    INTO TABLE @$2');
            }

            if (options.indexOf('error-handling') >= 0 || options.indexOf('debug') >= 0) {
                if (!/sy-subrc/i.test(refined) && /SELECT/i.test(refined)) {
                    refined = refined.replace(/(SELECT[\s\S]*?INTO TABLE[^.]*\.)/gi,
                        '$1\n\n  IF sy-subrc <> 0.\n    MESSAGE \'No data\' TYPE \'S\' DISPLAY LIKE \'W\'.\n  ENDIF.');
                }
            }

            if (options.indexOf('comments') >= 0) {
                refined = refined.replace(/^(FORM\s+(\w+)\.)/gim,
                    '*&---------------------------------------------------------------------*\n*& Form $2\n*&---------------------------------------------------------------------*\n$1');
            }

            if (options.indexOf('selection') >= 0 && !/PARAMETERS|SELECT-OPTIONS/i.test(refined)) {
                var sel = '\nPARAMETERS: p_vkorg TYPE vkorg.\nSELECT-OPTIONS: s_erdat FOR sy-datum.\n\nSTART-OF-SELECTION.\n';
                refined = refined.replace(/(REPORT\s+\w+\.)/i, '$1' + sel);
            }

            if (options.indexOf('alv') >= 0 && !/cl_salv_table/i.test(refined)) {
                refined += '\n\nFORM display_alv USING pt_data TYPE STANDARD TABLE.\n';
                refined += '  TRY.\n';
                refined += '      cl_salv_table=>factory(\n';
                refined += '        IMPORTING r_salv_table = DATA(lo_alv)\n';
                refined += '        CHANGING t_table = pt_data ).\n';
                refined += '      lo_alv->display( ).\n';
                refined += '    CATCH cx_salv_msg.\n';
                refined += '  ENDTRY.\n';
                refined += 'ENDFORM.';
            }

            if (req) {
                refined = '* Requirement: ' + req.substring(0, 60) + '\n' + refined;
            }

            return refined;
        }
    </script>
</body>
</html>
